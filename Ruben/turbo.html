<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trivia Turbo</title>
  <style>
    body {
  margin: 0;
  font-family: 'Arial', sans-serif;
  background: radial-gradient(circle at center, #e0cd8f, #b38941 80%);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

/* Niveau select box */
#niveau-select {
  position: absolute;
  top: 110px;
  margin-bottom: 20px;
  text-align: center;
}


#niveau-select select {
  padding: 5px 7px;
  font-size: 1rem;
  border-radius: 15px;
  background-color: #ffffff;
  color: rgb(0, 0, 0);
  cursor: pointer;
  transition: all 0.3s ease;
}


#start-btn {
  position: absolute;       /* zwevend boven de box */
  top: 80px;                 /* verticaal centreren */
  left: 50%;                /* horizontaal centreren */
  transform: translate(-50%, -50%); /* echt in het midden */
  padding: 12px 24px;
  font-size: 20px;
  border: none;
  border-radius: 8px;
  background-color: #ffffff;
  color: rgb(0, 0, 0);
  cursor: pointer;
  z-index: 10;              /* boven de question-box */
}

#start-btn:hover {
  background-color: #ffe5b1;
}
.game-container {
  text-align: center;
  width: 800px;
}





.timer-display {
  position: relative;
  bottom: -100%;
  color: #ffffff;
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 10px;
}


.track {
  position: relative;
  width: 800px;
  height: 100px;
  margin-bottom: 40px;
}

.road {
  width: 100%;
  height: 60px;
  background-color: #333;
  border-radius: 30px;
  position: absolute;
  top: 20px;
  overflow: hidden;
}

.lane-stripes {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%;
  padding: 0 20px;
}

.stripe {
  width: 20px;
  height: 8px;
  background-color: white;
  border-radius: 4px;
}

.flag {
  position: absolute;
  top: -50px;
  left: 680px;
  width: 70px;
  height: auto;
  transition: left 0.8s ease;

}
.car {
  position: absolute;
  top: -5px;
  left: 20px;
  width: 150px;
  height: auto;
  transition: left 0.8s ease;
}

#reset-btn {
  position: absolute; 
  top: -70px;            /* afstand vanaf de bovenkant */
  right: 10px; 
  width: 50px;
  height: 50px; 
  cursor: pointer;    
}



.question-box {
  position: relative;
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  color: #fff;              /* witte tekst */
  font-size: 1.2em;         /* iets grotere tekst */
}

.overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20;
  
}

.overlay.hidden {
  display: none;
}

.overlay.start {
  backdrop-filter: blur(3px);
}

.overlay.error {
  background-color: rgba(255, 71, 71, 0.696);
  color: white;
  font-size: 24px;
  font-weight: bold;
}





.wetenschap {
  background-image: url("wetenschap.png");
  background-size: cover;
  background-position: center;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  color: #fff;
  font-size: 1.2em;
}

.geschiedenis {
  background-image: url("geschiedenis.png");
  background-size: cover;
  background-position: center;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  color: #fff;
  font-size: 1.2em;

}
.leaderboard {
  position: absolute;
  top: 3px;
  left: 15px;
  color: #ffffff;
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 10px;
}

.sport {
  background-image: url("sport.png");
  background-size: cover;
  background-position: center;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  color: #fff;
  font-size: 1.2em;
}


.answers button {
  margin: 10px;
  padding: 10px 20px;
  font-size: 18px;
  border: none;
  border-radius: 5px;
  background-color: #f77f00;
  color: white;
  cursor: pointer;
}

.answers button:hover {
  background-color: #d62828;
}

.streak-box {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
}

.streak-icon {
  width: 30px;
  height: auto;
  margin-right: 10px;
}

#streak-count {
  font-size: 24px;
  font-weight: bold;
  color: #d65c28;
}


  </style>
</head>
<body>
  <div class="game-container">
    <div class="track">
      <div class="road">
        <div class="lane-stripes">
          <!-- Je stripes -->
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
          <div class="stripe"></div>
        </div>
      </div>
      <img src="assets/car.png" alt="Red Car" class="car" id="car" />
      <img src="assets/flag.png" alt="flag" class="flag" id="flag" />
      <div id="timer" class="timer-display">‚è±Ô∏è Tijd: 0.00s</div>
    </div>

    <!-- Streak display -->
    <div class="streak-box">
      <img src="assets/streak.png" alt="Streak Icon" class="streak-icon" />
      <span id="streak-count">0</span>
    </div>

    <!-- Vraag + antwoorden -->
    <div class="question-box" id="question-box">
      
      <!-- Overlay voor start (samengevoegd: niveau + startknop) -->
      <div id="overlay-start" class="overlay start">
        <div id="niveau-select">
          <select id="niveau">
            <option value="1">Niveau 1</option>
            <option value="2">Niveau 2</option>
            <option value="3">Niveau 3</option>
          </select>
        </div>
        <button id="start-btn">Start</button>
      </div>

      <!-- Overlay voor fouten -->
      <div id="overlay-error" class="overlay error hidden">
        <span>Helaas!</span>
      </div>

      <img id="reset-btn" src="assets/reset.png" alt="Reset" class="reset-icon">
      <div id="question">Vraag komt hier...</div>
      <div class="answers">
        <button></button>
        <button></button>
        <button></button>
      </div>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard">
      <h2>üèÜ Highscores</h2>
      <ol id="highscore-list">
        <!-- Dynamisch gevuld via script.js -->
      </ol>
    </div>
  </div>

  <!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // Config ophalen uit een extern JSON-bestand
  async function loadFirebaseConfig() {
    const response = await fetch('firebaseConfig.json'); // pad naar je JSON-bestand
    if (!response.ok) {
      throw new Error("Kon firebaseConfig.json niet laden");
    }
    return await response.json();
  }

  // Initialiseer Firebase met config uit JSON
  loadFirebaseConfig().then(firebaseConfig => {
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Maak Firestore beschikbaar voor andere scripts
    window.db = db;
  }).catch(error => {
    console.error("Fout bij laden Firebase config:", error);
  });

  
// Firebase imports
import { collection, addDoc, getDocs, query, orderBy, limit } 
  from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

let timerStarted = false;
let startTime = null;
let timerInterval = null;

function startTimer() {
  startTime = Date.now();
  timerStarted = true;
  timerInterval = setInterval(updateTimerDisplay, 10);
}

async function stopTimer() {
  clearInterval(timerInterval);
  const totalSeconds = (Date.now() - startTime) / 1000;
  document.getElementById("timer").textContent = 
    `‚è±Ô∏è Tijd: ${totalSeconds.toFixed(2)}s`;

  try {
    await addDoc(collection(window.db, "gameTimes"), {
      time: totalSeconds.toFixed(2),
      streak: streak,
      niveau: currentNiveau,
      date: new Date().toISOString()
    });
    console.log("Tijd opgeslagen in Firestore!");
    loadHighscores();
  } catch (err) {
    console.error("Kon tijd niet opslaan:", err);
  }
}

function updateTimerDisplay() {
  const elapsed = (Date.now() - startTime) / 1000;
  document.getElementById("timer").textContent = 
    `‚è±Ô∏è Tijd: ${elapsed.toFixed(2)}s`;
}

function resetGame() {
  carPosition = 20;
  document.getElementById("car").style.left = carPosition + "px";

  streak = 0;
  document.getElementById("streak-count").textContent = streak;

  clearInterval(timerInterval);
  timerStarted = false;
  startTime = null;
  document.getElementById("timer").textContent = "‚è±Ô∏è Tijd: 0.00s";

  // overlay en niveau-select weer zichtbaar maken
  document.getElementById("overlay-start").classList.remove("hidden");
  document.getElementById("niveau-select").classList.remove("hidden");

  // niveau opnieuw ophalen uit dropdown
  currentNiveau = parseInt(document.getElementById("niveau").value, 10);

  loadQuestion();
}

document.getElementById("reset-btn").onclick = resetGame;

// üëâ Startknop event
document.getElementById("start-btn").onclick = () => {
  // overlay en niveau-select verbergen
  document.getElementById("overlay-start").classList.add("hidden");
  document.getElementById("niveau-select").classList.add("hidden");

  if (!timerStarted) {
    // niveau ophalen bij start
    currentNiveau = parseInt(document.getElementById("niveau").value, 10);
    startTimer();
  }
};

let carPosition = 20;
let streak = 0;
let currentNiveau = 1;
const winDistance = 600;

let allQuestions = [];
let questionPools = { 1: [], 2: [], 3: [] };

const categories = ["wetenschap.json", "geschiedenis.json", "sport.json"];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function loadAllQuestions() {
  const promises = categories.map(cat =>
    fetch("./" + cat).then(res => res.json())
  );

  Promise.all(promises)
    .then(results => {
      allQuestions = results.flat();

      // Verdeel vragen per niveau
      questionPools[1] = shuffle(allQuestions.filter(q => q.niveau === 1));
      questionPools[2] = shuffle(allQuestions.filter(q => q.niveau === 2));
      questionPools[3] = shuffle(allQuestions.filter(q => q.niveau === 3));

      loadQuestion();
    })
    .catch(err => {
      console.error("Kon vragen niet laden:", err);
      document.getElementById("question").textContent = "Fout bij laden van vragen!";
    });
}

function loadQuestion() {
  if (questionPools[currentNiveau].length === 0) {
    // Als pool leeg is, opnieuw vullen
    questionPools[currentNiveau] = shuffle(allQuestions.filter(q => q.niveau === currentNiveau));
  }

  const q = questionPools[currentNiveau].pop();
  const questionBox = document.getElementById("question");
  questionBox.textContent = q.question;
  questionBox.className = q.category || "";

  const buttons = document.querySelectorAll(".answers button");

  let opts = Array.isArray(q.options) ? [...q.options] : [];
  const correct = q.correct;

  if (!opts.includes(correct)) {
    opts.push(correct);
  }
  opts = [...new Set(opts)];
  let shuffled = shuffle(opts);

  const count = Math.min(buttons.length, shuffled.length);
  shuffled = shuffled.slice(0, count);

  if (!shuffled.includes(correct)) {
    shuffled[count - 1] = correct;
    shuffled = shuffle(shuffled);
  }

  buttons.forEach((btn, i) => {
    if (i < count) {
      const value = shuffled[i];
      btn.textContent = value;
      btn.dataset.isCorrect = String(value === correct);
      btn.disabled = false;
      btn.style.display = "";
      btn.onclick = () => checkAnswer(btn, q);
    } else {
      btn.textContent = "";
      btn.dataset.isCorrect = "false";
      btn.disabled = true;
      btn.style.display = "none";
      btn.onclick = null;
    }
  });
}

function checkAnswer(button, q) {
  const isCorrect = button.dataset.isCorrect === "true";

  if (isCorrect) {
    streak++;
    document.getElementById("streak-count").textContent = streak;

    let step = 10;
    if (streak >= 2) step = 30;
    if (streak >= 3) step = 50;
    if (streak >= 5) step = 90;
    if (streak >= 7) step = 120;

    carPosition += step;
    document.getElementById("car").style.left = carPosition + "px";

    if (carPosition >= winDistance) {
      stopTimer();
      setTimeout(() => {
        alert("üèÅ Gefeliciteerd! Je hebt de finish gehaald!");
      }, 500);
      return;
    }

    setTimeout(loadQuestion, 1000);
  } else {
    streak = 0;
    document.getElementById("streak-count").textContent = streak;

    // ‚ùå Error overlay tonen
    const errorOverlay = document.getElementById("overlay-error");
    errorOverlay.classList.remove("hidden");

    setTimeout(() => {
      errorOverlay.classList.add("hidden");
      loadQuestion();
    }, 1000);
  }
}

// üî• Leaderboard ophalen
async function loadHighscores() {
  const q = query(collection(window.db, "gameTimes"), orderBy("time", "asc"), limit(10));
  const snapshot = await getDocs(q);
  const list = document.getElementById("highscore-list");
  list.innerHTML = "";
  snapshot.forEach(doc => {
    const data = doc.data();
    const li = document.createElement("li");
    li.textContent = `${data.time}s (streak: ${data.streak}, niveau: ${data.niveau})`;
    list.appendChild(li);
  });
}

// Start automatisch
window.onload = () => {
  loadAllQuestions();
  loadHighscores();
};

</script>

</body>
</html>
