#include <SPI.h>
#include <MFRC522.h>
#include <Keyboard.h> 

#define SS_PIN 10
#define RST_PIN 9

MFRC522 mfrc522(SS_PIN, RST_PIN);

// --- CONFIGURATIE ---
String masterCard = "29 A2 15 B9"; // Jouw kaart ID
String email = "admin123@gmail.com";
String wachtwoord = "Admin123";

void setup() {
  Serial.begin(9600);
  // Terwijl Serial niet open is, gaan we toch door na een korte delay 
  // om te voorkomen dat hij vastloopt als hij niet aan een PC hangt.
  delay(2000); 
  
  Serial.println("=== RFID Login Systeem ===");
  Serial.println("Initializing SPI...");
  
  SPI.begin();
  
  Serial.println("Initializing MFRC522...");
  mfrc522.PCD_Init();
  delay(100); 
  
  byte version = mfrc522.PCD_ReadRegister(mfrc522.VersionReg);
  Serial.print("MFRC522 Firmware versie: 0x");
  Serial.println(version, HEX);
  
  if (version == 0x00 || version == 0xFF) {
    Serial.println("⚠️ FOUT: RC522 niet gevonden!");
    while(1); 
  } else {
    Serial.println("✓ RC522 communicatie OK!");
  }
  
  mfrc522.PCD_DumpVersionToSerial();
  
  Keyboard.begin();
  
  Serial.println("\n✓ Systeem gereed!");
  Serial.print("Master kaart UID: ");
  Serial.println(masterCard);
  Serial.println("\n>>> Houd je kaart/tag DICHT bij de reader <<<\n");
}

void loop() {
  if (!mfrc522.PICC_IsNewCardPresent()) {
    return;
  }

  if (!mfrc522.PICC_ReadCardSerial()) {
    Serial.println("⚠️ Kaart detectie gefaald");
    return;
  }

  Serial.println("\n━━━━━━━━━━━━━━━━━━━━━━");
  Serial.println("✓ Kaart gedetecteerd!");

  String uidStr = "";
  for (byte i = 0; i < mfrc522.uid.size; i++) {
    if (mfrc522.uid.uidByte[i] < 0x10) {
      uidStr += "0";
    }
    uidStr += String(mfrc522.uid.uidByte[i], HEX);
    if (i < mfrc522.uid.size - 1) {
      uidStr += " ";
    }
  }
  uidStr.toUpperCase();

  Serial.print("Gescande UID:  ");
  Serial.println(uidStr);

  if (uidStr == masterCard) {
    Serial.println("\n✓✓✓ CORRECT! Inloggen... ✓✓✓\n");
    
    // --- STAP 1: BEGIN MET TAB ---
    Keyboard.press(KEY_TAB);
    Keyboard.releaseAll();
    delay(200); // Korte pauze zodat de computer de tab verwerkt

    // --- STAP 2: TYPE EMAIL ---
    Keyboard.print(email);
    delay(100);
    
    // --- STAP 3: DRUK TAB (naar wachtwoord veld) ---
    Keyboard.press(KEY_TAB); 
    Keyboard.releaseAll();
    delay(200);

    // --- STAP 4: TYPE WACHTWOORD ---
    Keyboard.print(wachtwoord); 
    delay(100);

    // --- STAP 5: DRUK ENTER ---
    Keyboard.press(KEY_RETURN);
    Keyboard.releaseAll();
    
    Serial.println("Login credentials verstuurd!");
  } else {
    Serial.println("\n✗✗✗ FOUT! Onbekende kaart ✗✗✗\n");
  }

  mfrc522.PICC_HaltA();
  
  Serial.println("━━━━━━━━━━━━━━━━━━━━━━");
  Serial.println("Wacht 2 seconden voor volgende scan...\n");
  
  delay(2000); 
}
